{% extends "base.html" %}

{% block title %}User Dashboard - Dawlance OST{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 dark:bg-gray-900">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <!-- Compact Header Section -->
        <div class="bg-gradient-to-r from-blue-600 to-blue-800 rounded-lg shadow p-6 mb-6">
            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-white bg-opacity-20 rounded-lg flex items-center justify-center mr-3">
                        <i class="fas fa-user text-xl text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-white">
                            Welcome, {{ session.full_name or session.username }}!
                        </h1>
                        <p class="text-blue-100 text-sm mt-1">
                            Track cost reduction initiatives in real-time
                        </p>
                    </div>
                </div>
                <div class="flex items-center space-x-4 text-blue-100 text-sm">
                    <div class="flex items-center">
                        <i class="fas fa-calendar-alt mr-2"></i>
                        <span>{{ moment().format('MMM D, YYYY') }}</span>
                    </div>
                    <div class="flex items-center">
                        <i class="fas fa-clock mr-2"></i>
                        <span id="current-time"></span>
                    </div>
                    <div class="hidden sm:block bg-white bg-opacity-15 backdrop-blur-sm rounded-lg p-3 text-center">
                        <div class="text-lg font-bold text-white">{{ total_projects or '0' }}</div>
                        <div class="text-blue-100 text-xs">Total Projects</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Compact Statistics Grid -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 mb-6">
            <!-- Total Projects -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700 p-4">
                <div class="flex items-center justify-between">
                    <div class="p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg">
                        <i class="fas fa-project-diagram text-blue-600 dark:text-blue-400"></i>
                    </div>
                    <div class="text-right">
                        <p class="text-xs font-semibold text-gray-500 dark:text-gray-400">Total Projects</p>
                        <p class="text-xl font-bold text-gray-900 dark:text-white">{{ total_projects or '0' }}</p>
                    </div>
                </div>
                <div class="mt-2">
                    <div class="flex items-center justify-between text-xs text-gray-500 dark:text-gray-400">
                        <span>+12.5% this month</span>
                        <span>75%</span>
                    </div>
                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1.5 mt-1">
                        <div class="bg-blue-500 h-1.5 rounded-full" style="width: 75%"></div>
                    </div>
                </div>
            </div>

            <!-- Pending Review -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700 p-4">
                <div class="flex items-center justify-between">
                    <div class="p-2 bg-orange-100 dark:bg-orange-900/30 rounded-lg">
                        <i class="fas fa-clock text-orange-600 dark:text-orange-400"></i>
                    </div>
                    <div class="text-right">
                        <p class="text-xs font-semibold text-gray-500 dark:text-gray-400">Pending Review</p>
                        <p class="text-xl font-bold text-gray-900 dark:text-white">{{ pending_projects or '0' }}</p>
                    </div>
                </div>
                <div class="mt-2">
                    <div class="flex items-center justify-between text-xs text-gray-500 dark:text-gray-400">
                        <span class="text-red-500 dark:text-red-400">3 urgent</span>
                        <span>60%</span>
                    </div>
                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1.5 mt-1">
                        <div class="bg-orange-500 h-1.5 rounded-full" style="width: 60%"></div>
                    </div>
                </div>
            </div>

            <!-- Approved Projects -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700 p-4">
                <div class="flex items-center justify-between">
                    <div class="p-2 bg-green-100 dark:bg-green-900/30 rounded-lg">
                        <i class="fas fa-check-circle text-green-600 dark:text-green-400"></i>
                    </div>
                    <div class="text-right">
                        <p class="text-xs font-semibold text-gray-500 dark:text-gray-400">Approved Projects</p>
                        <p class="text-xl font-bold text-gray-900 dark:text-white">{{ approved_projects or '0' }}</p>
                    </div>
                </div>
                <div class="mt-2">
                    <div class="flex items-center justify-between text-xs text-gray-500 dark:text-gray-400">
                        <span class="text-green-500 dark:text-green-400">94.2% success</span>
                        <span>94%</span>
                    </div>
                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1.5 mt-1">
                        <div class="bg-green-500 h-1.5 rounded-full" style="width: 94%"></div>
                    </div>
                </div>
            </div>

            <!-- Total Savings -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700 p-4">
                <div class="flex items-center justify-between">
                    <div class="p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg">
                        <i class="fas fa-dollar-sign text-purple-600 dark:text-purple-400"></i>
                    </div>
                    <div class="text-right">
                        <p class="text-xs font-semibold text-gray-500 dark:text-gray-400">Total Savings</p>
                        <p class="text-xl font-bold text-gray-900 dark:text-white">
                            ${{ "{:,.0f}".format(total_savings) if total_savings else '0' }}
                        </p>
                    </div>
                </div>
                <div class="mt-2">
                    <div class="flex items-center justify-between text-xs text-gray-500 dark:text-gray-400">
                        <span class="text-green-500 dark:text-green-400">+28.4%</span>
                        <span>85%</span>
                    </div>
                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1.5 mt-1">
                        <div class="bg-purple-500 h-1.5 rounded-full" style="width: 85%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Combined Quick Actions and Analytics Section -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6">
            <!-- Quick Actions (Left Column) -->
            <div class="lg:col-span-1 bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700">
                <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                    <h2 class="text-lg font-bold text-gray-900 dark:text-white flex items-center">
                        <i class="fas fa-bolt text-yellow-500 mr-2"></i>
                        Quick Actions
                    </h2>
                </div>
                <div class="p-4 grid grid-cols-2 gap-3">
                    <a href="{{ url_for('project_type') }}" class="bg-blue-500 hover:bg-blue-600 p-4 rounded-lg text-white transition-colors shadow-sm hover:shadow-md">
                        <div class="flex flex-col items-center text-center">
                            <i class="fas fa-plus-circle text-xl mb-2"></i>
                            <span class="text-sm font-semibold">New Project</span>
                        </div>
                    </a>
                    <a href="#" class="bg-green-500 hover:bg-green-600 p-4 rounded-lg text-white transition-colors shadow-sm hover:shadow-md">
                        <div class="flex flex-col items-center text-center">
                            <i class="fas fa-calendar-alt text-xl mb-2"></i>
                            <span class="text-sm font-semibold">Timeline</span>
                        </div>
                    </a>
                    <a href="#" class="bg-indigo-600 hover:bg-indigo-700 p-4 rounded-lg text-white transition-colors shadow-sm hover:shadow-md">
                        <div class="flex flex-col items-center text-center">
                            <i class="fas fa-chart-pie text-xl mb-2"></i>
                            <span class="text-sm font-semibold">ROI Analysis</span>
                        </div>
                    </a>
                    <a href="{{ url_for('documentation') }}" class="bg-gray-700 hover:bg-gray-800 p-4 rounded-lg text-white transition-colors shadow-sm hover:shadow-md">
                        <div class="flex flex-col items-center text-center">
                            <i class="fas fa-question-circle text-xl mb-2"></i>
                            <span class="text-sm font-semibold">Help</span>
                        </div>
                    </a>
                </div>
                
                <!-- Additional Mini Charts in Quick Actions -->
                <div class="p-4 space-y-4">
                    <!-- Project Completion Chart -->
                    <div class="bg-gray-50 dark:bg-gray-750 rounded-lg p-3 border border-gray-100 dark:border-gray-700">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-xs font-bold text-gray-900 dark:text-white">Project Completion</h3>
                            <span class="text-xs text-green-500 dark:text-green-400">↑ 22%</span>
                        </div>
                        <div id="completionChart" class="h-32"></div>
                    </div>
                    
                    <!-- Cost Savings Breakdown -->
                    <div class="bg-gray-50 dark:bg-gray-750 rounded-lg p-3 border border-gray-100 dark:border-gray-700">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-xs font-bold text-gray-900 dark:text-white">Savings Breakdown</h3>
                            <span class="text-xs text-blue-500 dark:text-blue-400">$128K</span>
                        </div>
                        <div id="savingsBreakdownChart" class="h-32"></div>
                    </div>
                </div>
            </div>

            <!-- Analytics Dashboard (Right Column) -->
            <div class="lg:col-span-2 bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700">
                <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between">
                    <h2 class="text-lg font-bold text-gray-900 dark:text-white flex items-center">
                        <i class="fas fa-chart-pie text-indigo-500 mr-2"></i>
                        Project Analytics
                    </h2>
                    <div class="flex items-center space-x-2">
                        <select class="bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1 text-xs focus:ring-1 focus:ring-indigo-500 text-gray-900 dark:text-white">
                            <option>Last 30 days</option>
                            <option>Last 90 days</option>
                            <option>Last year</option>
                        </select>
                        <button class="bg-indigo-500 hover:bg-indigo-600 text-white px-2 py-1 rounded-md text-xs font-semibold">
                            <i class="fas fa-download mr-1"></i>Export
                        </button>
                    </div>
                </div>
                <div class="p-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <!-- Status Distribution -->
                        <div class="bg-gray-50 dark:bg-gray-750 rounded-lg p-4 border border-gray-100 dark:border-gray-700">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-sm font-bold text-gray-900 dark:text-white">Project Status</h3>
                                <span class="text-xs text-gray-500 dark:text-gray-400">Updated 2 min ago</span>
                            </div>
                            <div id="statusChart" class="h-48"></div>
                            <div class="flex justify-between mt-3 text-xs">
                                <span class="flex items-center"><span class="w-2 h-2 bg-green-500 rounded-full mr-1"></span> Approved (67%)</span>
                                <span class="flex items-center"><span class="w-2 h-2 bg-orange-500 rounded-full mr-1"></span> Pending (25%)</span>
                                <span class="flex items-center"><span class="w-2 h-2 bg-red-500 rounded-full mr-1"></span> Rejected (8%)</span>
                            </div>
                        </div>
                        
                        <!-- ROI Analysis Chart -->
                        <div class="bg-gray-50 dark:bg-gray-750 rounded-lg p-4 border border-gray-100 dark:border-gray-700">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-sm font-bold text-gray-900 dark:text-white">ROI Analysis</h3>
                                <span class="text-xs text-blue-500 dark:text-blue-400 font-bold">↑ 15.2%</span>
                            </div>
                            <div id="roiChart" class="h-48"></div>
                            <div class="flex justify-between mt-3 text-xs">
                                <span class="flex items-center"><span class="w-2 h-2 bg-blue-500 rounded-full mr-1"></span> Approved (42%)</span>
                                <span class="flex items-center"><span class="w-2 h-2 bg-purple-500 rounded-full mr-1"></span> Monitoring (35%)</span>
                                <span class="flex items-center"><span class="w-2 h-2 bg-cyan-500 rounded-full mr-1"></span> Projects (23%)</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Monthly Performance Chart -->
                    <div class="bg-gray-50 dark:bg-gray-750 rounded-lg p-4 border border-gray-100 dark:border-gray-700">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-sm font-bold text-gray-900 dark:text-white">Monthly Performance</h3>
                            <div class="flex items-center space-x-2 text-xs">
                                <span class="flex items-center"><span class="w-2 h-2 bg-blue-500 rounded-full mr-1"></span> Projects</span>
                                <span class="flex items-center"><span class="w-2 h-2 bg-green-500 rounded-full mr-1"></span> Savings ($K)</span>
                            </div>
                        </div>
                        <div id="performanceChart" class="h-48"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Compact Projects Section -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700">
            <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3">
                <div>
                    <h2 class="text-lg font-bold text-gray-900 dark:text-white flex items-center">
                        <i class="fas fa-folder-open text-blue-500 mr-2"></i>
                        My Projects
                    </h2>
                    <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">Manage your cost reduction initiatives</p>
                </div>
                <div class="flex items-center space-x-2 w-full sm:w-auto">
                    <div class="relative flex-grow sm:flex-grow-0">
                        <input type="text" placeholder="Search..." class="bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md pl-8 pr-3 py-1.5 text-sm w-full focus:ring-1 focus:ring-blue-500 text-gray-900 dark:text-white">
                        <i class="fas fa-search absolute left-2.5 top-2.5 text-gray-400 text-sm"></i>
                    </div>
                    <a href="{{ url_for('project_type') }}" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1.5 rounded-md text-sm font-semibold whitespace-nowrap">
                        <i class="fas fa-plus mr-1"></i>New
                    </a>
                </div>
            </div>
            
            <div class="p-4">
                {% if projects %}
                    <div class="space-y-3">
                        {% for project in projects %}
                        <div class="group bg-gray-50 dark:bg-gray-750 border border-gray-200 dark:border-gray-600 rounded-lg p-4 hover:shadow-sm transition-all">
                            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center space-x-3 mb-2">
                                        <div class="w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center">
                                            <i class="fas fa-project-diagram text-white text-sm"></i>
                                        </div>
                                        <h3 class="text-base font-bold text-gray-900 dark:text-white truncate">
                                            {{ project.project_name or 'Untitled Project' }}
                                        </h3>
                                    </div>
                                    
                                    <div class="flex flex-wrap items-center gap-2 mb-3">
                                        <span class="px-2 py-0.5 text-xs font-bold rounded-full
                                            {% if project.status == 'Approved' %}
                                                bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300
                                            {% elif project.status == 'Pending' %}
                                                bg-orange-100 dark:bg-orange-900/30 text-orange-800 dark:text-orange-300
                                            {% elif project.status == 'Rejected' %}
                                                bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300
                                            {% else %}
                                                bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300
                                            {% endif %}">
                                            {{ project.status or 'Draft' }}
                                        </span>
                                        {% if project.priority == 'High' or project.priority == 'Medium' %}
                                        <span class="px-2 py-0.5 text-xs font-bold rounded-full
                                            {% if project.priority == 'High' %}bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300
                                            {% else %}bg-orange-100 dark:bg-orange-900/30 text-orange-800 dark:text-orange-300{% endif %}">
                                            {{ project.priority }} Priority
                                        </span>
                                        {% endif %}
                                        <span class="text-xs text-gray-500 dark:text-gray-400">
                                            <i class="fas fa-industry mr-1"></i>{{ project.factory or 'N/A' }}
                                        </span>
                                        <span class="text-xs text-gray-500 dark:text-gray-400">
                                            <i class="fas fa-dollar-sign mr-1"></i>${{ project.potential_savings or '0' }}
                                        </span>
                                    </div>
                                    
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1.5">
                                        <div class="bg-blue-500 h-1.5 rounded-full" style="width: 75%"></div>
                                    </div>
                                </div>
                                
                                <div class="flex space-x-2">
                                    <a href="{{ url_for('user_project_details', project_id=project.project_id) }}" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1.5 rounded-md text-sm font-semibold whitespace-nowrap">
                                        <i class="fas fa-eye mr-1"></i>View
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <!-- Pagination -->
                    <div class="flex items-center justify-between mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                        <div class="text-xs text-gray-500 dark:text-gray-400">
                            Showing 1 to {{ projects|length }} of {{ projects|length }} projects
                        </div>
                        <div class="flex space-x-1">
                            <button class="px-2.5 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-md text-xs font-semibold">
                                Previous
                            </button>
                            <button class="px-2.5 py-1 bg-blue-500 text-white rounded-md text-xs font-semibold">1</button>
                            <button class="px-2.5 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-md text-xs font-semibold">
                                2
                            </button>
                            <button class="px-2.5 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-md text-xs font-semibold">
                                Next
                            </button>
                        </div>
                    </div>
                {% else %}
                    <!-- Empty State -->
                    <div class="text-center py-8">
                        <div class="w-20 h-20 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-project-diagram text-3xl text-gray-400 dark:text-gray-500"></i>
                        </div>
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2">No projects yet</h3>
                        <p class="text-gray-600 dark:text-gray-400 mb-4 text-sm max-w-md mx-auto">
                            Start your cost reduction journey by creating your first project.
                        </p>
                        <a href="{{ url_for('project_type') }}" class="inline-flex items-center bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-semibold">
                            <i class="fas fa-plus mr-2"></i>Create Project
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<!-- ApexCharts -->
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Update current time
    function updateTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString('en-US', { 
            hour12: true, 
            hour: '2-digit', 
            minute: '2-digit'
        });
        const timeElement = document.getElementById('current-time');
        if (timeElement) {
            timeElement.textContent = timeString;
        }
    }
    updateTime();
    setInterval(updateTime, 60000);

    // Chart theme configuration
    const isDarkMode = document.documentElement.classList.contains('dark');
    
    const chartTheme = {
        theme: {
            mode: isDarkMode ? 'dark' : 'light',
            palette: 'palette1'
        },
        grid: {
            borderColor: isDarkMode ? '#374151' : '#E5E7EB',
            padding: {
                top: 10,
                right: 10,
                bottom: 10,
                left: 10
            }
        },
        chart: {
            toolbar: {
                show: false
            },
            animations: {
                enabled: true,
                easing: 'easeinout',
                speed: 800
            }
        }
    };

    // Get data from Flask template
    const mockStatusData = {{ status_distribution | tojson | safe }};
    const mockROIData = {{ roi_distribution | tojson | safe }};
    const mockMonthlyProjects = {{ monthly_projects | tojson | safe }};
    const mockMonthlySavings = {{ monthly_savings | tojson | safe }};
    const mockMonthlyLabels = {{ monthly_labels | tojson | safe }};
    const mockSavingsCategories = {{ savings_categories | tojson | safe }};
    const mockSavingsValues = {{ savings_values | tojson | safe }};

    console.log("Chart Data Loaded:", {
        statusData: mockStatusData,
        roiData: mockROIData,
        monthlyProjects: mockMonthlyProjects,
        monthlySavings: mockMonthlySavings,
        monthlyLabels: mockMonthlyLabels,
        savingsCategories: mockSavingsCategories,
        savingsValues: mockSavingsValues
    });

    // Initialize charts only if their containers exist
    if (document.querySelector("#statusChart")) {
        const statusOptions = {
            series: mockStatusData,
            chart: {
                type: 'donut',
                height: '100%',
                parentHeightOffset: 0
            },
            labels: ['Approved', 'Pending', 'Rejected'],
            colors: ['#10B981', '#F59E0B', '#EF4444'],
            plotOptions: {
                pie: {
                    donut: {
                        size: '70%',
                        labels: {
                            show: true,
                            total: {
                                show: true,
                                label: 'Total',
                                fontSize: '12px',
                                fontWeight: 600,
                                color: isDarkMode ? '#F9FAFB' : '#111827'
                            },
                            value: {
                                fontSize: '20px',
                                fontWeight: 700,
                                color: isDarkMode ? '#F9FAFB' : '#111827'
                            }
                        }
                    }
                }
            },
            dataLabels: {
                enabled: false
            },
            legend: {
                show: false
            },
            tooltip: {
                y: {
                    formatter: function(value) {
                        return value + ' projects';
                    }
                }
            },
            ...chartTheme
        };
        const statusChart = new ApexCharts(document.querySelector("#statusChart"), statusOptions);
        statusChart.render();
    }

    if (document.querySelector("#roiChart")) {
        const roiOptions = {
            series: mockROIData,
            chart: {
                type: 'pie',
                height: '100%',
                parentHeightOffset: 0
            },
            labels: ['Approved', 'Monitoring', 'Projects'],
            colors: ['#3B82F6', '#8B5CF6', '#06B6D4'],
            plotOptions: {
                pie: {
                    size: '70%',
                    donut: {
                        size: '0%'
                    }
                }
            },
            dataLabels: {
                enabled: false
            },
            legend: {
                show: false
            },
            tooltip: {
                y: {
                    formatter: function(value) {
                        return value + '%';
                    }
                }
            },
            ...chartTheme
        };
        const roiChart = new ApexCharts(document.querySelector("#roiChart"), roiOptions);
        roiChart.render();
    }

    if (document.querySelector("#performanceChart")) {
        const performanceOptions = {
            series: [{
                name: 'Projects',
                type: 'column',
                data: mockMonthlyProjects
            }, {
                name: 'Savings ($K)',
                type: 'line',
                data: mockMonthlySavings
            }],
            chart: {
                height: '100%',
                parentHeightOffset: 0,
                type: 'line',
                toolbar: {
                    show: false
                }
            },
            colors: ['#3B82F6', '#10B981'],
            stroke: {
                width: [0, 3],
                curve: 'smooth'
            },
            plotOptions: {
                bar: {
                    columnWidth: '50%',
                    borderRadius: 4
                }
            },
            xaxis: {
                categories: mockMonthlyLabels,
                labels: {
                    style: {
                        colors: isDarkMode ? '#9CA3AF' : '#6B7280',
                        fontSize: '10px'
                    }
                }
            },
            yaxis: [{
                title: {
                    text: 'Projects',
                    style: {
                        color: isDarkMode ? '#9CA3AF' : '#6B7280',
                        fontSize: '10px'
                    }
                },
                labels: {
                    style: {
                        colors: isDarkMode ? '#9CA3AF' : '#6B7280',
                        fontSize: '10px'
                    }
                }
            }, {
                opposite: true,
                title: {
                    text: 'Savings ($K)',
                    style: {
                        color: isDarkMode ? '#9CA3AF' : '#6B7280',
                        fontSize: '10px'
                    }
                },
                labels: {
                    formatter: function(value) {
                        return '$' + value + 'K';
                    },
                    style: {
                        colors: isDarkMode ? '#9CA3AF' : '#6B7280',
                        fontSize: '10px'
                    }
                }
            }],
            tooltip: {
                shared: true,
                intersect: false,
                y: [{
                    formatter: function(value) {
                        return value + ' projects';
                    }
                }, {
                    formatter: function(value) {
                        return '$' + value + 'K';
                    }
                }]
            },
            legend: {
                show: false
            },
            ...chartTheme
        };
        const performanceChart = new ApexCharts(document.querySelector("#performanceChart"), performanceOptions);
        performanceChart.render();
    }

    if (document.querySelector("#completionChart")) {
        const completionOptions = {
            series: [72],
            chart: {
                height: '100%',
                type: 'radialBar',
            },
            plotOptions: {
                radialBar: {
                    startAngle: -135,
                    endAngle: 135,
                    hollow: {
                        margin: 0,
                        size: '70%',
                    },
                    dataLabels: {
                        name: {
                            offsetY: -10,
                            color: isDarkMode ? '#9CA3AF' : '#6B7280',
                            fontSize: '10px'
                        },
                        value: {
                            color: isDarkMode ? '#F9FAFB' : '#111827',
                            fontSize: '20px',
                            fontWeight: 700,
                            show: true,
                            offsetY: 5,
                        }
                    },
                    track: {
                        background: isDarkMode ? '#374151' : '#E5E7EB',
                        strokeWidth: '97%',
                        margin: 5,
                    }
                }
            },
            fill: {
                type: 'gradient',
                gradient: {
                    shade: 'dark',
                    shadeIntensity: 0.15,
                    inverseColors: false,
                    opacityFrom: 1,
                    opacityTo: 1,
                    stops: [0, 50, 65, 91]
                },
                colors: ['#10B981']
            },
            stroke: {
                dashArray: 4
            },
            labels: ['Completion Rate'],
            ...chartTheme
        };
        const completionChart = new ApexCharts(document.querySelector("#completionChart"), completionOptions);
        completionChart.render();
    }

    if (document.querySelector("#savingsBreakdownChart")) {
        const savingsBreakdownOptions = {
            series: [{
                name: 'Savings',
                data: mockSavingsValues
            }],
            chart: {
                type: 'bar',
                height: '100%',
                stacked: false,
            },
            plotOptions: {
                bar: {
                    horizontal: true,
                    barHeight: '80%',
                    borderRadius: 4,
                    distributed: true,
                },
            },
            colors: ['#3B82F6', '#8B5CF6', '#EC4899', '#F59E0B', '#10B981'],
            dataLabels: {
                enabled: false
            },
            xaxis: {
                categories: mockSavingsCategories,
                labels: {
                    style: {
                        colors: isDarkMode ? '#9CA3AF' : '#6B7280',
                        fontSize: '10px'
                    }
                },
                axisBorder: {
                    show: false
                }
            },
            yaxis: {
                labels: {
                    style: {
                        colors: isDarkMode ? '#9CA3AF' : '#6B7280',
                        fontSize: '10px'
                    }
                }
            },
            tooltip: {
                y: {
                    formatter: function(value) {
                        return '$' + value + 'K';
                    }
                }
            },
            ...chartTheme
        };
        const savingsBreakdownChart = new ApexCharts(document.querySelector("#savingsBreakdownChart"), savingsBreakdownOptions);
        savingsBreakdownChart.render();
    }

    // Update charts when theme changes
    const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            if (mutation.attributeName === 'class') {
                const newIsDarkMode = document.documentElement.classList.contains('dark');
                
                const charts = [
                    statusChart, roiChart, performanceChart, 
                    completionChart, savingsBreakdownChart
                ].filter(chart => chart !== undefined);
                
                charts.forEach(chart => {
                    chart.updateOptions({
                        theme: {
                            mode: newIsDarkMode ? 'dark' : 'light'
                        },
                        grid: {
                            borderColor: newIsDarkMode ? '#374151' : '#E5E7EB'
                        }
                    });
                });
            }
        });
    });
    
    observer.observe(document.documentElement, { attributes: true });
});
</script>
{% endblock %}